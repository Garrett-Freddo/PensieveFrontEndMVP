<!-- Include stylesheet -->
<script href="highlight.js"></script>
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src = "https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.16/mammoth.browser.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.2/knockout-min.js"></script>

</head>
<body>
  <input type="file" onchange="parseWordDocxFile(this)">
  <script>
  function parseWordDocxFile(inputElement) {
    var files = inputElement.files || [];
    if (!files.length) return;
    var file = files[0];

    console.time();
    var reader = new FileReader();
    reader.onloadend = function(event) {
      var arrayBuffer = reader.result;
      // debugger

      mammoth.convertToHtml({arrayBuffer: arrayBuffer}).then(function (resultObject) {
        output.innerHTML = resultObject.value
      })
      console.timeEnd();
    };
    reader.readAsArrayBuffer(file);
  }
</script>



  <!--------------------------------->
  <ul data-bind="foreach: selectedText">
    <li data-bind="text: $data"></li>
</ul>
  <div id = "editor">
  </div>

<textarea id="output"></textarea>
<script src="script.js"></script>
</body>
</html>

<!-- Include the Quill library -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>


<!-- Initialize Quill editor -->
<button onclick="Initialize()"></button>
<script>

var self = this; 
    //Create an observable array to display the text that you highlight with your cursor.
self.selectedText = ko.observableArray([]);

  function Initialize() {
  var quill = new Quill('#editor', {
    modules: {            // Include syntax module
    toolbar: [['code-block']]  // Include button in toolbar
  },
    theme: 'snow'
  });
quill.setContents();
const value = document.getElementById('output').textContent
const delta = quill.clipboard.convert(value)
quill.setContents(delta, 'silent')

//this is the "AI" automatic highlighting
let length = quill.getLength()
var text = quill.getText(0, length);
for(let i = 0; i < length; ++i) {
  if(keyWordPatternMatcher(i, text, length) ) {
    findNextPeriodAndHighlight(i, text);
  }
}

function keyWordPatternMatcher(startIndex, text, length) {
  if(text.length - startIndex > 10) { //ensures there will be no out of bounds/ useless highlights
    if(text[startIndex] === 'T') {
      console.log(text[startIndex])
      text = text.toLowerCase();
      if(text[startIndex + 1] === 'h') {
        if(text[startIndex + 2] === 'i') {
          if(text[startIndex + 3] === 's') {
            return true;
          }
        }
      }
    }
  }
  return false;
}


function findNextPeriodAndHighlight(startIndex, text) {
  for(let i = startIndex; i < text.length; ++i) {
    if(text[i] === '.') {
      quill.formatText(startIndex, i - startIndex, {                   
          'color': 'rgb(204,204,0)'
          }, true);
          highlightedText = text.slice(startIndex, i);
          self.selectedText.push(highlightedText);
          return 0;
    }
  }

}

function ViewModel(){

    //This function will be called when you make a change in the text, in this case, highlighting a word. 
    quill.on('selection-change', function(range, oldRange, source){
        //This will get the text range that you highlighted.
        var text = quill.getText(range.index, range.length);
        if(self.selectedText().includes(text)){
            quill.formatText(range.index, range.length, {                   
            'color': 'rgb(0,0,0)'
        }, true);
            self.selectedText.remove(text);
        } else if(text.length > 0) {
            quill.formatText(range.index, range.length, {                   
          'color': 'rgb(204,204,0)'
          }, true);
          self.selectedText.push(text);
        }
    })
}
ko.applyBindings(new ViewModel());


}
</script>